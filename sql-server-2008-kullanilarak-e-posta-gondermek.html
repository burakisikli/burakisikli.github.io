<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title></title>

            <link href="http://www.burakisikli.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title=" Full Atom Feed" />
            <link href="http://www.burakisikli.com/feeds/sql-server.atom.xml" type="application/atom+xml" rel="alternate" title=" Categories Atom Feed" />

        <!-- Bootstrap Core CSS -->
        <link href="http://www.burakisikli.com/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="http://www.burakisikli.com/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="http://www.burakisikli.com/theme/css/code_blocks/darkly.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->




        <meta name="tags" contents="E-mail" />
        <meta name="tags" contents="E-posta" />
        <meta name="tags" contents="Email" />
        <meta name="tags" contents="Eposta" />
        <meta name="tags" contents="SQL Server" />


			<meta property="og:locale" content="en">
		<meta property="og:site_name" content="">

	<meta property="og:type" content="article">
	<meta property="article:author" content="">
	<meta property="og:url" content="http://www.burakisikli.com/sql-server-2008-kullanilarak-e-posta-gondermek.html">
	<meta property="og:title" content="SQL Server 2008 Kullanılarak E-posta Göndermek">
	<meta property="og:description" content="">
	<meta property="og:image" content="http://www.burakisikli.com/">
	<meta property="article:published_time" content="2009-02-15 01:56:00+02:00">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://www.burakisikli.com/"></a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('http://www.burakisikli.com/theme/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>SQL Server 2008 Kullanılarak E-posta Göndermek</h1>
                        <span class="meta">Posted by
                                <a href="http://www.burakisikli.com/author/burakisikli.html">burakisikli</a>
                             on Sun 15 February 2009
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <div>

<span style="font-family:verdana;font-size:85%;">SQL Server kullanarak
e-posta nasıl gönderilecek bunu anlatacağım. SQL Server 2000 mail
gönderme sistemine sahipti fakat mail gönderebilmek için mutlaka MAPI
alt yapısına sahip bir sistem hazırlamamız şarttı. Bu yapı aynen SQL
Server 2005’de de tüm özellikleriyle korunuyor. Ancak gerekli hatta
olmazsa olmaz diyebileceğimiz geliştirme geldi ve Database Mail isimli
yeni bir mail gönderme sistemi SQL Server 2005’e eklendi. En önemli
özelliklerinden biri artık MAPI alt yapısına ihtiyaç duymadan herhangi
bir SMTP sunucu tanımlanarak gönderim yapılabiliyor. Bunun anlamı gmail
hesabınızı sisteme tanımlayarak SQL Server 2005 üzerinden mail
gönderebileceğinizdir.</span>

</div>

<div>

<span style="font-family:verdana;font-size:85%;">**Güvenilirlik :**  
Database Mail, önemli özelliklerinden biri olarak ön plana çıkan Simple
Mail Transfer Protocol (SMTP) kullanabilme yeteneği ile göz doldurduğu
kadar mail gönderme işleminin SMTP sayesinde SQL Server’dan ayrılmış
olması ile güvenilirliği de artırmıştır. Bu sayede mail gönderme işlemi
sırasında SQL Server 2005 çok daha az kaynak kullanarak performans kaybı
yaşamayacak, herhangi bir dış kaynaklı sorundan ise etkilenmeyecektir.
Yine Database Mail sisteminin gelişmiş özelliklerinden biri de SMTP
sunucusunda oluşan herhangi bir sorunda gönderilecek mailleri beklemeye
alıp SMTP sunucusundaki sorun giderildikten sonra tekrar
gönderebilmesidir. Ayrıca bir Database Mail profili birden fazla SMTP
sunucusu barındırabilir. Böylece kullanım dışı bir SMTP sunucusu varsa
tanımlı diğer SMTP sunucuları üzerinden mail gönderimi yapılabilir.
İlginç bir diğer özellik ise HTML formatında mail
gönderebilmeniz.</span>

</div>

<div>

<span style="font-family:verdana;font-size:85%;">Kurulum ve Tanımlar :  
Şimdi biraz Database Mail i yakından tanıyalım ve sonra diğer
özelliklerine geçelim.</span>  
<span style="font-family:verdana;font-size:85%;">  
[![](http://4.bp.blogspot.com/_FhRCL5jj9p8/SZdc9h6YE4I/AAAAAAAAAEY/0nw6jOYPiUM/s320/1.jpg)](http://4.bp.blogspot.com/_FhRCL5jj9p8/SZdc9h6YE4I/AAAAAAAAAEY/0nw6jOYPiUM/s1600-h/1.jpg)Object
Explorer üzerinde görüldüğü gibi Database Mail, Management başlığı
altına konumlandırılmış. SQL 2000’den aşina olduğumuz MAPI tabanlı SQL
Mail sistemi ise yine aynı başlık altında Legacy (= miras) isimli alt
başlık içerisine eklenmiş. Eklendiği yerin ismi gibi gerçekten SQL
2000’den miras kaldı...</span>

</div>

<div>

<span style="font-family:verdana;font-size:85%;">  
</span>

</div>

<div>

[![](http://4.bp.blogspot.com/_FhRCL5jj9p8/SZdb3IRqKVI/AAAAAAAAAEI/3UMrGe2_0iY/s320/2.jpg)](http://4.bp.blogspot.com/_FhRCL5jj9p8/SZdb3IRqKVI/AAAAAAAAAEI/3UMrGe2_0iY/s1600-h/2.jpg)  
<span style="font-family:verdana;font-size:85%;">Database Mail üzerine
sağ tuşla kliklediğimizde açılan menüden ulaşabileceğimiz Configure
Database Mail sihirbazına yine Database Mail üzerine çift tıklayarak da
ulaşabiliyoruz.</span>  
<span style="font-family:verdana;font-size:85%;">Açılan sihirbaz basitçe
bir profil tanımlayarak bu profil için SMTP sunucuları tanımlamanızı
kolaylaştırıyor.</span>

</div>

<div>

<span style="font-family:verdana;font-size:85%;">  
</span>

</div>

<div>

<p>
[![](http://3.bp.blogspot.com/_FhRCL5jj9p8/SZddvlFvupI/AAAAAAAAAEg/DDKO-QCjscA/s320/3.1.jpg)](http://3.bp.blogspot.com/_FhRCL5jj9p8/SZddvlFvupI/AAAAAAAAAEg/DDKO-QCjscA/s1600-h/3.1.jpg)
[![](http://4.bp.blogspot.com/_FhRCL5jj9p8/SZdd-pUAHxI/AAAAAAAAAEo/pWuiOQR7Zdw/s320/3.jpg)](http://4.bp.blogspot.com/_FhRCL5jj9p8/SZdd-pUAHxI/AAAAAAAAAEo/pWuiOQR7Zdw/s1600-h/3.jpg)

</div>

<div>

<span style="font-family:verdana;font-size:85%;">En üstteki seçenekle
devam ettiğimizde profil tanımlaması yapabileceğimiz ve bu profile SMTP
sunucuları tanımlayabileceğimiz ekran açılıyor. Öncelikle bir profil
ismi girip açıklama bilgilerini doldurmamız yararlı olacaktır.</span>

</div>

<div>

[](http://1.bp.blogspot.com/_FhRCL5jj9p8/SZdei51sppI/AAAAAAAAAEw/WWb0XFoPqSw/s1600-h/4.jpg)<span
style="font-family:verdana;font-size:85%;">[![](http://2.bp.blogspot.com/_FhRCL5jj9p8/SZdmWxd1B-I/AAAAAAAAAFw/iadjWcZqlOI/s320/7.jpg)](http://2.bp.blogspot.com/_FhRCL5jj9p8/SZdmWxd1B-I/AAAAAAAAAFw/iadjWcZqlOI/s1600-h/7.jpg)Profil
tanımlamalarını yaptıktan sonra ise SMTP accounts: bölümünden Add -&gt;
New Account tuşu ile SMTP sunucularını ekliyoruz. SMTP sunucularını
eklerken bir isim verdikten sonra Outlook Express benzeri bir tanımlama
ekranıyla SMTP sunucu adresini, kullanıcı adı ve şifreyi gerekli
alanlara giriyoruz.</span>

</div>

<div>

<p>
[![](http://2.bp.blogspot.com/_FhRCL5jj9p8/SZdfiEQYquI/AAAAAAAAAE4/yiaSbys1MLc/s320/5.jpg)](http://2.bp.blogspot.com/_FhRCL5jj9p8/SZdfiEQYquI/AAAAAAAAAE4/yiaSbys1MLc/s1600-h/5.jpg)
<span style="font-family:verdana;font-size:85%;">Birkaç SMTP sunucusu
tanımladıktan sonra bunların önceliklerini de seçili sunucunun sırasını
değiştirerek ayarlayabiliyoruz. Özellikle dikkat edeceğiniz nokta
tanımlama yaparken Gmail gibi sunucularda "This server requires a secure
connection(SSL)" işaretli olması gerekmektedir. Bunu öğrenmek için
kullandığınız sunucunun bu özelliği destekleyip desteklemediğine
bakmanız gerekmektedir. Eğer bu özelliği destekleyip siz kullanmazsanız
e-posta göndermede "kullanıcı geçersiz" hatası alırsınız.</span>

</div>

<div>

[![](http://1.bp.blogspot.com/_FhRCL5jj9p8/SZdgFHYTzrI/AAAAAAAAAFA/m1iDmSRK6Eg/s320/6.jpg)](http://1.bp.blogspot.com/_FhRCL5jj9p8/SZdgFHYTzrI/AAAAAAAAAFA/m1iDmSRK6Eg/s1600-h/6.jpg)<span
style="font-family:verdana;font-size:85%;">İşleme devam ettiğimizde
aşağıdaki gibi sistem parametrelerini değiştirebileceğimiz bir yönetim
ekranı açılacaktır. Burada gerekli ayarları da yaptıktan sonra SQL
Server 2008'in profilimizi oluşturması ve accountları tanımlaması için
devam edebiliriz.</span>

</div>

<div>

<span style="font-family:verdana;font-size:85%;">  
</span>

</div>

<div>

<p>
[![](http://3.bp.blogspot.com/_FhRCL5jj9p8/SZdl2UnoUtI/AAAAAAAAAFo/1ejAfxxLulQ/s320/7.jpg)](http://3.bp.blogspot.com/_FhRCL5jj9p8/SZdl2UnoUtI/AAAAAAAAAFo/1ejAfxxLulQ/s1600-h/7.jpg)<span
style="font-family:verdana;font-size:85%;">Tüm bu işlemlerin ardından
profilimiz oluşturulacak ve SMTP hesapları bu profille
ilişkilendirilecektir.  
</span>

</div>

<div>

<span style="font-family:verdana;font-size:85%;">**Ölçeklenebilirlik :  
**Database Mail eş zamanlı olarak ve/veya arka planda çalışarak mail
gönderme işlemlerini yapar. sp\_send\_dbmail stored procedure
çağrıldığında Database Mail, Service Broker bekleme listesine bir istek
sırası ataması yapar. Ardından stored procedure işletilerek dış mail
sunucusuna istek gönderilir ve mail teslim edilir.  
Çoklu profil desteği sayesinde birden fazla profil tanımlanabilir ve
istenilen profil stored procedure parametresiyle belirlenerek mail
gönderilebilir. Yine aynı şekilde çoklu SMTP hesabı desteğiyle bir
profile birden fazla SMTP sunucusu tanımlanabilir. SMTP hesapları ve
profiller birbirlerinden ayrı değerlendirildiği için aynı SMTP hesapları
farklı profiller için kullanılabilir durumdadır.</span>

</div>

<div>

**Güvenlik :**  
Öntanımlı olarak Database Mail kullanımı kapalıdır. Bu yüzden Database
Mail’i kullanabilmek için SQL Server Surface Area Configuration aracı
kullanılarak Database Mail stored procedure kullanıma açılmalıdır.  
<span style="font-family:verdana;font-size:85%;">Ancak daha önceden
bahsettiğimiz gibi SQL Server 2008'de Surface Area Configuration aracı
facet altındadır. Policy Management -&gt; Facet -&gt; Surface Area
Configuration gelip sağ tıklayıp properties seçiyoruz.</span>

</div>

<p><a href="http://1.bp.blogspot.com/_FhRCL5jj9p8/SZdivFq3_FI/AAAAAAAAAFQ/Uc-x0dxwBpE/s1600-h/8.1.jpg"><img alt="" src="http://1.bp.blogspot.com/_FhRCL5jj9p8/SZdivFq3_FI/AAAAAAAAAFQ/Uc-x0dxwBpE/s320/8.1.jpg" /></a>
<a href="http://3.bp.blogspot.com/_FhRCL5jj9p8/SZdi1rMnhEI/AAAAAAAAAFY/es4kZ9stpRM/s1600-h/8.jpg"><img alt="" src="http://3.bp.blogspot.com/_FhRCL5jj9p8/SZdi1rMnhEI/AAAAAAAAAFY/es4kZ9stpRM/s320/8.jpg" /></a></p>
<div>

<span style="font-family:verdana;font-size:85%;">Database Mail
gönderebilmek için kullanıcının DatabaseMailUserRole isimli veritabanı
kullanıcı tanımına üye olması gerekir. Ayrıca profil güvenliği de
mevcuttur. Buna göre tanımlayacağınız Database Mail profillerinden
public olarak ayarlanan profil tüm msdb veritabanı kullanıcıları
tarafından mail göndermek için kullanılabilecektir. Public olarak
tanımlanmamış tüm diğer profillere ise ayrıntılı kullanıcı güvenlik
ayarları tanımlanabilir.  
Database Mail ile gönderilecek dosya boyutuna sınırlama getirilebilir.
Bu konuda aktif bir yönetim sistemi bulunuyor. Yine gönderilecek
dosyalarda uzantı sınırlaması da yapılabilir.</span>

</div>

<div>

**Kullanım :**  
Database Mail kullanımı sp\_send\_dbmail isimli stored procedure
aracılığıyla yapılabiliyor. Kullanımı xp\_sendmail yapısına benzemekle
birlikte bir çok ek parametre desteklenmiş. Aşağıda tam bir sytax ve
örnek bir kullanımı bulunuyor.

</div>

<p><img alt="" src="http://1.bp.blogspot.com/_FhRCL5jj9p8/SZdjPeF6NII/AAAAAAAAAFg/wQCk2EzYo1A/s320/9.jpg" /></p>
<p>[sourcecode language='sql']<br />
DECLARE @email nvarchar(50)<br />
DECLARE emailCursor CURSOR FOR<br />
SELECT email FROM deneme;<br />
OPEN emailCursor;<br />
FETCH NEXT FROM emailCursor INTO @email<br />
WHILE (@@FETCH_STATUS = 0)<br />
BEGIN<br />
EXEC msdb.dbo.sp_send_dbmail@profile_name='deneme',<br />
@recipients=@email,@body='deneme',@body_format='HTML',<br />
@subject='deneme';<br />
FETCH NEXT FROM emailCursor INTO @email<br />
END<br />
CLOSE emailCursor<br />
DEALLOCATE emailCursor<br />
GO<br />
[/sourcecode]</p>
<p><span style="font-family:verdana;font-size:85%;">Bu kadar basit bir
olay. Database Mail seçeneğine gelip "Send Test E-mail" tıklayarak
sistemin çalışıp çalışmadığını kontrol edebilirsiniz...</span></p>
    </article>

    <hr>

        <div class="comments">
            <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'burakisikli-com';
                var disqus_identifier = 'sql-server-2008-kullanilarak-e-posta-gondermek.html';
                var disqus_url = 'http://www.burakisikli.com/sql-server-2008-kullanilarak-e-posta-gondermek.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//burakisikli-com.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="http://twitter.com/burakisikli">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="http://github.com/burakisikli">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="http://www.burakisikli.com/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="http://www.burakisikli.com/theme/js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="http://www.burakisikli.com/theme/js/clean-blog.min.js"></script>

<script type="text/javascript">
    var disqus_shortname = 'burakisikli-com';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>